var timestamp,release_date,keyword,contact_i,contacts,parent,place,service,token;function refresh_page(){var e={action:"client",keyword:$("#keyword").val()};callAPI_GET(e,function(e){construct_main_menu(e.loginStatus,e.bulletins),"in"==e.loginStatus?e.errors?gotoURL(htaccess.invalid):(fillData(e),page_loading("done")):gotoLoginPage()})}function fillData(e){parent=e.service.parent;var a=(contacts=e.service.contacts).messages;service=e.service.data,place=e.service.place,contact_i=contacts.me;var t=e.service.tarif;if(keyword=e.service.keyword,token=e.service.token,$(".keyword").html(keyword),$(".client-name").html(service.first_name+" "+service.last_name+" (nar."+service.dob+")"),$("#place-name-desktop").html(place.name).off("click").on("click",function(){gotoURL(htaccess.place,"st","/"+place.id+"/"+keyword)}),$("#place-name-mobile").html(place.nickname),$(".place-link").prop("href","/st/"+htaccess.place+"/"+place.id),$(".avatar-src").attr("src",service.avatar.data),0!=service.release_date?(release_date=service.release_date.date.date,$("#release_date_desktop").html(service.release_date.date.str.full),$("#release_date_mobile").html(service.release_date.date.str.short),$("#release_date_result").html("Výstup: "+service.release_date.date.str.full),"ended"==service.release_date.result&&(service.release_date.result="ukončeno"),$(".release_info").html("("+service.release_date.result+")"),$("#remove_release_date_link").show(),$(".release_undefined").hide(),$(".release_defined").show()):($("#remove_release_date_link").hide(),$(".release_undefined").show(),$(".release_defined").hide(),$("#release_date_result").html("Výstup: neuvedeno")),$("#remove_release_date").off("click").on("click",function(){submit_release_date(1)}),$(".release_modal").off("click").on("click",function(){open_release_date_modal()}),$("#cb2_release_date").off("click").on("click",function(){submit_release_date()}),$("#desktop-avatar-link").off("click").on("click",function(){$("#modalavatar").modal("show")}),$("#message_button").off("click").on("click",function(){window.location.replace("/"+htaccess.sms+"/"+keyword)}),a&&($(".sms-left").html(a.sms.left),$(".mms-left").html(a.mms.left),$("#tarif-sms-limits-desktop").html(" - "+t.sms.ctn+" "+t.sms.str+" každý den (až "+t.sms.len+" znaků na zprávu)"),$("#tarif-sms-limits-mobile").html(" - "+t.sms.ctn+" "+t.sms.str+" každý den (max. "+t.sms.len+"zn.)")),$(".tarif-nickname").html(t.nickname),$("#male-avatar").off("click").on("click",function(){set_avatar(1)}),$("#female-avatar").off("click").on("click",function(){set_avatar(2)}),$("#custom-avatar").off("click").on("click",function(){$("#modalavatar").modal("hide"),$("#file").trigger("click")}),$("#ddays-label").html(t.ddays.label),$("#ddays-result").html(t.ddays.result.auto),contacts.sharing.total>1||0==contacts.sharing.total){if($("#sharing-label").html("Sdílení služby - uživatelé"),0==contacts.sharing.total);}else $("#sharing-label").html("uživatel služby");$("#tarif-end-label1,#tarif-end-info-date_str").removeClass(),$("#tarif-end-label1,#tarif-end-info-date_str").addClass("text-default"),$(".send-sms-button").hide();var n="";0==t.end.state&&($("#tarif-end-label1").html("Neaktivováno"),n="Zaplatit a zaktivovat"),1==t.end.state||2==t.end.state?((a.sms.left||a.mms.left)&&(a.sms.left&&a.mms.left&&$("#send-sms-button-label").html("Odeslat zprávu nebo foto"),a.sms.left&&!a.mms.left&&$("#send-sms-button-label").html("Odeslat zprávu"),!a.sms.left&&a.mms.left&&$("#send-sms-button-label").html("Odeslat foto"),$("#send-sms-button").show(),$("#send-sms-button").off("click").on("click",function(){gotoURL(htaccess.sms,"nc","/"+keyword)})),n="Zaplatit - prodloužit",$("#tarif-end-label1").html(t.end.label1),$("#tarif-end-info-date_str").html(t.end.date.str.full),1==t.end.state&&$("#tarif-end-info-result").html(" ("+t.end.label2+" "+t.end.result+")"),$("#mms-limit-label").show()):$("#sms_button_container").hide(),3==t.end.state&&(n="Zaplatit - znovu aktivovat",$("#tarif-end-label1,#tarif-end-info-date_str").removeClass(),$("#tarif-end-label1,#tarif-end-info-date_str").addClass("text-danger"),$("#tarif-end-label1").html(t.end.label1),$("#tarif-end-info-date_str").html(t.end.date_str)),$("#payment-link").html(n+'<span class="fa fa-angle-right"></span>'),$("#payment-link").on("click",function(){open_payment()}),$(".update-place-button").off("click").on("click",function(){open_places()}),$("#payments-history-link").off("click").on("click",function(){gotoURL(htaccess.payments,null,"/1/"+keyword)}),$("#tarif-details").off("click").on("click",function(){gotoURL(htaccess.mytarif,"nc","/"+keyword)}),$(".waits-content").html(waiting_messages()),$(".toggleSwitch").removeClass("fa-toggle-on").addClass("fa-toggle-off"),toggle_switch(0,contacts.list[contact_i].appsettings.hide),$("#switch0").off("click").on("click",function(){toggle_hide()}),1==e.payments&&$("#payment-history-link").show(),0==e.payments&&$("#payment-history-link").hide(),contact_list()}function toggle_switch(e,a){0==a?($("#hidden-info").hide(),$("#switch"+e).removeClass("fa-toggle-on text-danger").addClass("fa-toggle-off")):($("#hidden-info").show(),$("#switch"+e).removeClass("fa-toggle-off").addClass("fa-toggle-on text-danger"))}function toggle_hide(){var e={action:"contact-hide",keyword:$("#keyword").val()};callAPI_GET(e,function(e){"in"==e.loginStatus?e.success?toggle_switch(0,e.hide_state):gotoURL(htaccess.invalid_link,"st"):gotoLoginPage()})}function waiting_messages(){if(service.waiting.all.sms&&service.waiting.all.mms)var e=service.waiting.all.sms+" sms + "+service.waiting.all.mms+" foto";if(service.waiting.all.sms&&!service.waiting.all.mms)e=service.waiting.all.sms+" sms";if(!service.waiting.all.sms&&service.waiting.all.mms)e=service.waiting.all.mms+" foto";if(!service.waiting.all.sms&&!service.waiting.all.mms)e="žádné sms/foto";return e}function open_places(){var e="";callAPI_GET({action:"place-list"},function(a){$("#places-options").children().remove().end(),$.each(a.places,function(a,t){e=t.id==place.id?" selected":"",$("#places-options").append('<option value="'+t.id+'"'+e+">"+t.nickname+"</option>")})}),$("#places-options").on("change",function(){load_place()}),$("#place_address").html(place.address.street+" "+place.address.number+"<br>"+place.address.city+" "+place.address.zip),$("#place_details").val(place.address.details),$("#cb2_update_place").off("click").on("click",function(){update_place()}),$("#modalupdate_place").modal("show")}function load_place(){var e={action:"place",id:$("#places-options").val()};callAPI_GET(e,function(e){$("#place_address").html(e.address.postal.street+" "+e.address.postal.number+"<br>"+e.address.postal.city+" "+e.address.postal.zip),$("#place_details").val("")})}function update_place(){var e={action:"client-update-place",id:$("#places-options").val(),place_details:$("#place_details").val(),keyword:keyword,token:token};callAPI_GET(e,function(e){"in"==e.loginStatus?e.success?(place=e.place,$("#place-name-desktop").html(e.place.name),$("#place-name-mobile").html(e.place.nickname),$("#modalupdate_place").modal("hide")):gotoURL(htaccess.invalid_link,"st"):gotoLoginPage()})}function open_payment(){callAPI_GET({action:"payment-options",keyword:keyword,token:token},function(e){if("in"==e.loginStatus)if(e.success){var a=e.options.duration_options;$("#modalpayment").modal("show"),$("#cb2_payment").hide(),1==e.options.activation?($("#two-weeks-notice").show(),$("#two-weeks-notice-accepted").hide()):($("#two-weeks-notice").hide(),$("#two-weeks-notice-accepted").show()),$("#two-weeks-notice-button").off("click").on("click",function(){$("#two-weeks-notice").hide(),$("#two-weeks-notice-accepted").show()}),$("#duration").on("change",function(){prepare_payment()}),$("#duration").children().remove().end().append('<option selected value="0">-- vyberte délku objednávky --</option>'),$.each(a,function(e){$("#duration").append('<option value="'+a[e].months+'">'+ +a[e].months+" "+a[e].label+": "+a[e].price_label+"</option>")})}else 2==e.errors[0].id&&($("#modalwaiting_payment").modal("show"),$("#cb2_waiting_payment").off("click").on("click",function(){gotoURL(htaccess.payments,null,"/1/"+keyword)}),$("#waiting_payment_ordernumber").html(e.errors[0].str)),4==e.errors[0].id&&errormodal(e.errors,'<span class="fa fa-danger"></span> Upozornění');else gotoLoginPage()})}function prepare_payment(){var e={action:"payment-prepare",keyword:keyword,duration:$("#duration").val(),token:token};callAPI_GET(e,function(e){if("in"==e.loginStatus){if($("#cb2_payment").show(),$("#gopay_redirect_info").hide(),e.address)var a=e.email+"<br>"+e.address[0]+" "+e.address[1]+"<br>"+e.address[2]+"<br>"+e.address[3]+" "+e.address[2];else a=e.email;if(e.price.vat>0)var t="Celkem (s DPH "+e.price.vat+"%) "+e.price.price_label;else t="Celkem "+e.price.price_label;e.price.units>1&&(t+=" ("+e.price.unit_price_label+"/měs)"),$("#prepayment-info").html("od "+e.limits.newstart_str+" do "+e.limits.newend_str+"<br>"+t+"<hr>Kontakt plátce: <br>"+a+"<br><br>"),$("#cb2_payment").off("click").on("click",function(){gotoURL(htaccess.paylink,"nc","/"+e.paylink)})}else gotoLoginPage()})}function contact_list(){var e="";$.each(contacts.list,function(a){e+=create_contact_list_item(a),$("#users_list").on("click","#list_item_link_"+a,function(){edit_contact(a)})}),$("#users_list").html(e)}function create_contact_list_item(e){var a=contacts.list[e];if(a.active)var t='<div id="contact_'+e+'"'+(1==a.ban?" style='text-decoration:line-through;'":"")+'><span class="monospaced">'+e+') </span><span class="fa fa-user text-success" id="list_item_ico_'+e+'"></span><span id="list_item_name_'+e+'">'+a.name+'</span> <span id="list_item_email_'+e+'" class="desktopOnly">- '+a.email+'</span> - <span class="text-link" id="list_item_link_'+e+'">upravit <span class="fa fa-angle-right"></span></span></div>';else{t='<div id="contact_'+e+'"><span class="monospaced">'+e+') </span><span class="fa fa-user text-gray"  id="list_item_ico_'+e+'"></span><span id="list_item_name_'+e+'">volný kontakt</span> <span id="list_item_email_'+e+'" class="desktopOnly">- nepoužito</span> - <span class="text-link" id="list_item_link_'+e+'">přidat <span class="fa fa-angle-right"></span></span></div>';$("#contact_"+e).css("text-decoration","none")}return t}function edit_contact(e){var a=contacts.list[e];$("#modalcontact").modal("show"),$("#modalcontact_email").val(a.email),$("#modalcontact_name").val(a.name),0==a.active?$("#modalcontact_ban").html(""):0==a.ban?$("#modalcontact_ban").html("Zablokovat"):$("#modalcontact_ban").html("Odblokovat"),$("#modalcontact_error").html(""),$("#modalcontact_ban").off("click").on("click",function(){ban_contact()}),$("#modalcontact_header_i").html(e),$("#modalcontact_i").val(e),$("#cb2_contact").off("click").on("click",function(){update_contact()})}function ban_contact(){var e=$("#modalcontact_i").val();callAPI_GET({action:"contact-ban",keyword:keyword,token:token,contact_i:e},function(a){"in"==a.loginStatus?a.success?(1==a.ban&&($("#modalcontact_ban").html("Odblokovat"),$("#modalcontact_error").html("Zablokováno OK!"),$("#contact_"+e).css("text-decoration","line-through"),contacts.list[e].ban=1),0==a.ban&&($("#modalcontact_ban").html("Zablokovat"),$("#modalcontact_error").html("Odblokováno OK!"),$("#contact_"+e).css("text-decoration","none"),contacts.list[e].ban=0)):$("#modalcontact_error").html(a.errors):gotoLoginPage()})}function update_contact(){var e=$("#modalcontact_i").val(),a={action:"contact-update",keyword:keyword,token:token,contact_i:e,name:$("#modalcontact_name").val(),email:$("#modalcontact_email").val()};callAPI_GET(a,function(a){"in"==a.loginStatus?!a.errors&&a.result?(contacts.list[e]={name:a.result.name,email:a.result.email,ban:a.result.ban},$("#list_item_name_"+e).html(a.result.name),$("#list_item_email_"+e).html(a.result.email),$("#list_item_ico_"+e).removeClass("text-gray").addClass("text-success"),$("#list_item_link_"+e).html('upravit <span class="fa fa-angle-right"></span>'),$("#modalcontact").modal("hide")):$("#modalcontact_error").html(a.errors):gotoLoginPage()})}function open_release_date_modal(){var e=new Date(1e3*timestamp),a=e.getFullYear();if($("#release_year,#release_month,#release_day").empty(),release_date)var t=release_date.split("-"),n=t[0],o=t[1],l=t[2];else o=e.getMonth(),l=e.getDay();$("#modalrelease_date").modal("show");for(var s=0;s<50;)i=n==a+s?" selected":"",$("#release_year").append('<option value="'+(a+s)+'"'+i+">"+(a+s)+"</option>"),s++;s=0;for(var i="";s<12;)i=o==s+1?" selected":"",$("#release_month").append('<option value="'+(s+1)+'"'+i+">"+months.base[s]+"</option>"),s++;for(s=1,i="";s<32;)i=l==s?" selected":"",$("#release_day").append('<option value="'+s+'"'+i+">"+s+"</option>"),s++}function submit_release_date(e){var a={action:"client-release",keyword:keyword,token:token,remove:e,year:$("#release_year").val(),month:$("#release_month").val(),day:$("#release_day").val()};callAPI_GET(a,function(e){e.success?location.reload():($("#modalrelease_date").modal("hide"),errormodal(e.errors))})}function set_avatar(e){callAPI_GET({action:"client-avatar-ico",keyword:keyword,token:token,ico:e},function(e){"in"==e.loginStatus?($(".avatar-src").attr("src",e.avatar.data),$("#modalavatar").modal("hide")):gotoLoginPage()})}function upload_avatar(e){callAPI_POST("client-avatar-img",{keyword:keyword,token:token,image:e},function(e){"in"==e.loginStatus?e.success?$(".avatar-src").attr("src",e.avatar.data):errormodal(e.errors):gotoLoginPage()})}$(document).ready(function(){page_loading("start","fa-angle-left","na hlavní stránku",function(){gotoURL(htaccess.home)})});
